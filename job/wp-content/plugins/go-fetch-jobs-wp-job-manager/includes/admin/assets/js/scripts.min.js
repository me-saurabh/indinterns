"use strict";jQuery(document).ready(function(e){function t(t){var a=e(".scrape-select-all");a.data("active",t?"selected":"");var n="selected";t||(n="none"),a.text(a.data(n))}function a(){var a=e('select[name="special[scrape][]"]'),n=a.next(".select2-container");if(e(".bulk-scrape-select, .scrape-info").remove(),a.length){var i=a.find("option").length,o=a.select2("data").length;n.after('<div class="bulk-scrape-select"><a class="scrape-select-all" data-none="Select All" data-selected="Clear All" data-active="">Select All</a></div>'),e(".bulk-scrape-select").after('<div class="scrape-info secondary-container"><span class="dashicons-before dashicons-warning"></span><div> '+goft_wpjm_admin_l18n.msg_try_scrape+" </div>"),t(i===o);var s=e(".scrape-select-all");s.on("click",function(n){if(""!==s.data("active"))a.val("").trigger("change"),t(!1);else{var i=[];a.find("option").each(function(){i.push(e(this).val())}),a.val(i).trigger("change"),t(!0)}return n.preventDefault(),!1})}}function n(){var t=e("select[name=feed-region_domains]").val(),a=e("select[name=feed-locale_code]").val(),n=e("select[name=feed-country]").val();e("input[name=feed-params-gofj-country-locale]").val(""),n?(e("input[name=feed-params-gofj-country-code]").val(n),e("input[name=feed-params-gofj-country-name]").val(e("select[name=feed-country] option:selected").text())):t?(e("input[name=feed-params-gofj-country-code]").val(t),e("input[name=feed-params-gofj-country-name]").val(e("select[name=feed-region_domains] option:selected").text())):a&&(e("input[name=feed-params-gofj-country-code]").val(""),e("input[name=feed-params-gofj-country-locale]").val(a),e("input[name=feed-params-gofj-country-name]").val(e("select[name=feed-locale_code] option:selected").text()))}function i(){var t=[],a=goft_wpjm_admin_l18n.core_fields||[];return Object.keys(a).forEach(function(n){var i=a[n];0==e("[name*=field_mapping]").filter(function(){return this.value==i}).length&&0==e(".mappings-core-field").filter(function(){return this.innerHTML==i}).length&&t.push(n)}),t}function o(t,a){var t=t||e("[class*=provider-expand]");t.each(function(){var t=e("."+e(this).data("child")),n=e(this).data("default");n=((void 0===a?t.is(":visible"):a)?"- ":"+ ")+n,e(this).text(n)})}function s(t,a){a=a||!1,e(".provider-expand-feed-builder").length?e(".provider-expand-feed-builder").click():e(".provider-expand-feed-manual-setup").click(),o(),void 0!==t.feed.query_args_sep&&(e(".feed-builder input[name=feed-params-sep]").val(t.feed.query_args_sep),e(".feed-builder input[name=feed-params-sep-pos]").val(t.feed.query_args_sep_pos));var n=t.feed.base_url;void 0!==t.feed.query_args&&(e("[class*=opt-param]:not(.domain-param)").hide(),e.each(t.feed.query_args,function(t,n){a&&e.each(Object.keys(n),function(e,t){if(a.get(t))return void(n[t]=a.get(t))}),e(".feed-builder .opt-param-"+t).last().show();var i=Object.keys(n)[0],o=void 0!==n[i]?void 0!==n[i].default_value?n[i].default_value:n[i]?n[i]:n[t]:"",s=void 0!==n[i].placeholder?n[i].placeholder:"",r=void 0!==n[i].required?n[i].required:"",d=void 0!==n[i].is_prefix?n[i].is_prefix:"",l=e(".feed-builder [name=feed-"+t+"]"),p=e(".feed-builder [name=feed-param-"+t+"]");if("domain_l"!==i&&"domain_k"!==i||e(".feed-builder input[name=feed-param-"+t+"]").attr("data-regex",n[i].regex),r&&e(".feed-builder .opt-param-"+t+" label").append(" "+r),p.val(i),p.data("default",o),s&&e(".feed-builder [name=feed-"+t+"]").attr("placeholder",s),o)if("multiple"===l.attr("multiple")){var c=o.split(",");l.val(c).trigger("change")}else e(".feed-builder [name=feed-"+t+"]").val(o);d&&p.attr("data-prefix",d)}),e("select[name*=feed-][multiple=multiple]").select2({placeholder:"Click to choose ..."})),e(".feed-builder input[name=feed-url]").val(n).keyup(),e(".feed-builder input[name=feed-url]").data("default",n)}function r(){var t=e("input[name=feed-url]").val(),a=e(".feed-builder input[name=feed-params-sep]").val();return void 0===t?t:("&"===a?t.indexOf("?")<0?t+="?":t+="&":t.indexOf(a)<0&&(t+=a),t)}function d(t){var a=C,n=e(".feed-builder input[name=feed-params-sep]").val(),i=e(".feed-builder input[name=feed-params-sep-pos]").val(),o=!!parseInt(e(".feed-builder input[name=feed-param-split-multi]").val()),s=[];e(".feed-builder .params [name*=feed-]").each(function(){var a=e(this).attr("data-qarg"),n=e("[name="+a+"]").data("default"),i=e(this).val(),o="";if(n=void 0!==n?n:"",o=void 0!==t[a]?t[a]:"",Array.isArray(i)&&i.length||!Array.isArray(i)&&i){var r=o||n;s[a]=r}}),t=s;for(var r in t)if(t.hasOwnProperty(r)&&void 0!==t[r]&&void 0!==t[r])if(("&"===n&&"?"!==a.slice(-1)||"&"!==n)&&n!==a.slice(-1)&&"before"!==i&&(a+=n),"before"===i)a=a.replace("?",t[r]+n+"?");else if(o){var d=decodeURIComponent(t[r]),p=d.split("=");if(p.length&&p[1]){var c=p[1].split(/(".*?"|[^",]+)(?=\s*,|\s*$)/g),m="";for(var f in c){var u=c[f].trim();u&&","!==u&&(u=u.replaceAll('"',""),u=u.replaceAll('"',""),u=u.replaceAll("'",""),u=l(u),m&&(m+="&"),m+=p[0]+"="+encodeURIComponent(u))}a+=m}}else a+=t[r];e(".provider-rss-custom").prop("href",a),e(".provider-rss-custom").text(a)}function l(e){var t=e.split(" "),a="";return t.map(function(e){if(a&&(a+=" "),"and"===e.toLowerCase()||"or"===e.toLowerCase())return a+=e;a+=e.charAt(0).toUpperCase()+e.substring(1)}),a}function p(t){var a=e("#rss_feed_import").val().split("?")[0];if(e("#rss_feed_import").attr("data-saved-url"))var n=e("#rss_feed_import").attr("data-saved-url").split("?")[0];return a!==n}function c(t,a){e.each(t,function(t,n){a||e('input[name="source['+t+']"]').val(n).change(),e('input[name="source['+t+']"]').attr("data-original",n).change()}),g("[section=source]")}function m(t){var a=[];void 0!==goft_wpjm_admin_l18n.default_query_args&&a.push(goft_wpjm_admin_l18n.default_query_args),void 0!==t.feed&&a.push(t.feed.query_args),e.each(a,function(t,a){void 0!==a&&e.each(a,function(t,a){var n="",i="";""!==Object.keys(a)[0]&&0===Object.keys(a)[0]?(n=a,t=n):n=Object.keys(a)[0],void 0!==(i=k(e("#rss_feed_import").val(),n))&&e("input[data-core-name="+t+"]").val(i).change()})})}function f(t){e(".tr-advanced, .tr-advanced + .section-advanced").addClass("tr-advanced-"+("advanced"===t?"show":"hide")),e(".tr-advanced, .tr-advanced + .section-advanced").removeClass("tr-advanced-"+("advanced"===t?"hide":"show"))}function u(){R&&e(".tr-advanced").promise().done(function(){e(".tr-advanced-show:not(.tr-toggle-hide)").show(),e(".tr-advanced-hide:not(.tr-toggle-hide)").hide()})}function _(t){t?(e(".import-notes").closest("tr").hide(),e(".import-posts").fadeIn()):(e(".import-notes").closest("tr").fadeIn(),e(".import-posts").hide()),h(t)}function v(t,a){e("[section=meta]").each(function(){if(e(this).filter("["+t+"]")){var n=e(this).filter("["+t+"]");n.is(":checkbox")?(n.val(a?1:0),n.prop("checked",a)):n.val(a)}})}function g(t){var a="";e(t).each(function(){var t=e(this).attr("section"),n="section-"+t,i="section-"+t+"-values",o=e(this).closest("tr"),s=e("th",o).text(),r="",d="";if(e('select, input[type!="button"], textarea',o).each(function(t,a){if(r=d="",e(this).is("select"))r=e(this).find(":selected").text();else if(e(this).is(":checkbox"))r=e(this).is(":checked")?goft_wpjm_admin_l18n.label_yes:goft_wpjm_admin_l18n.label_no;else if(e(this).val()){if(r=e(this).val(),d=e(this).attr("class"),x(r)){var n=document.createElement("a");n.href=r,r=null!==n.pathname.match(/\.(jpeg|jpg|gif|png|ico|svg)$/)?'<img src="'+r+'" class = "goft-image-thumb">':'<a href="'+r+'" class = "goft-link">'+r+"</a>"}}else""!==e(this).data("default")&&(r=e(this).data("default"))}),t!==a)if(e("."+i).length)e("."+i).html("");else{var l=e("."+n).closest("tr").hasClass("tr-always-hide")?"tr-always-hide":"",p='<tr class="section-advanced temp-tr-hide '+l+'"><td><a href="#" class="section-expand" expand="'+t+'">'+goft_wpjm_admin_l18n.msg_advanced+'</a></td><td class="tip">&nbsp;</td><td class="section-values '+i+'" colspan=5></td></tr>';e(".section-"+t).parents("tr").after(p)}r||(r="-");var c='<p class="goft-basic" data-classes="'+d+'"><strong>'+s+": </strong><span>"+r+"</span></p>";e("."+i).append(c),a=t})}function h(t){var a=e(".temp-tr-hide:not(.tr-toggle-hide)"),n=e(".temp-tr-hide:not(.tr-toggle-hide).tr-hide");t?a.fadeIn():(a.fadeOut(),n.removeClass("temp-tr-hide")),e(".tr-auto-schedule").hide()}function w(t){t?(e(".save-warning-schedule").hide(),e(".save-warning-regular").show()):(e(".save-warning-schedule").show(),e(".save-warning-regular").hide())}function j(e){var t=!0;return"yes"===goft_wpjm_admin_l18n.can_use_premium&&(t=goft_wpjm_admin_l18n.used_templates&&goft_wpjm_admin_l18n.used_templates.indexOf(e)>=0),w(t),t}function b(t){if(!t.id){var a="dashicons-"+(1===D?"minus":"plus");if(D++,t.children){var n=e('<span class="goft-wpjm-group">'+t.text+'<span class="dashicons-before '+a+' expand-minimize"></span></span>');return n}return t.text}if(e(t.element).data("desc"))var n=e("<span>"+e(t.element).val()+'<span class="provider-desc">'+e(t.element).data("desc")+"</span></span>");else var n=e("<span>"+t.text+"</span>");return n}function y(e){var t,a=/\/\/www\.(.*?)[\/\?]$/;if(null!==(t=a.exec(e)))for(var n=t.length-1;n>=0;n--)if(void 0!==t[n]&&""!==t[n])return"rss-"+t[n];return"my-rss-feed"}function x(e){var t=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/g;return new RegExp(t).test(e)}function k(e,t){t=t.replace(new RegExp("]","gm"),/[\[]/,"\\[").replace(new RegExp("]","gm"),/[\]]/,"\\]");var a=new RegExp("[\\?&/]"+t+"=([^&#/]*)"),n=a.exec(e);return null===n?"":decodeURIComponent(n[1].replace(new RegExp("]","gm"),/\+/g," "))}var C="",q=[],O="",R=!1,D=0,A="",E="",I="",S=!1,z=!1,U=e("#templates_list + .description"),P=function(){e(".tr-rss-toggle").hide(),e(".tr-rss-url").show()};if(e(".gofj-select2").select2(),e("#templates_list").select2({placeholder:goft_wpjm_admin_l18n.label_templates}),e("#providers_list").select2({width:"70%",minimumResultsForSearch:20,templateResult:b,placeholder:goft_wpjm_admin_l18n.label_providers}).maximizeSelect2Height(),e("#providers_list").on("select2:open",function(t){e("input.select2-search__field").prop("placeholder","type to search provider (e.g: Indeed, Marketing, Multi-Region, etc)"),e(document).on("keyup",".select2-search__field",function(){e(this).val()?e(".select2-results__option:not(:visible)").show():e(".select2-results__option:not(:first) li").hide()}),P()}),e(this).on("keyup",".required-param",function(){if(e(this).removeClass("required"),e(this).val())e(this).hasClass("required-or")&&e(".required-param.required").removeClass("required");else if(e(this).hasClass("required-or")){var t=e(".required-param.required-or").filter(function(){return""!=e(this).val()});t.length||e(".required-param").addClass("required")}else e(this).addClass("required");e(".no-jobs-found.required-parameters").remove()}),goft_wpjm_admin_l18n.geocode_api_key){var T={details:"form",detailsAttribute:"data-geo",country:[],type:["(regions)"]};if(e(".geocomplete").length)try{e(".geocomplete").geocomplete(T)}catch(e){console.error(e.message),console.error("Geolocation is not working. Please check that the google maps 'Places' library is being correctly loaded or not overriden by another plugin.")}}e("#from_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,onClose:function(t){e("#to_date").datepicker("option","minDate",t),e("#to_date").val()||e("#to_date").val(e("#from_date").val())}}),e("#to_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,onClose:function(t){e("#from_date").datepicker("option","maxDate",t)}}),function(){g("[section=taxonomies], [section=meta], [section=source]"),e("input.hidden").closest("tr").hide(),e("#templates_list").val(""),e(".rss-load-images").prop("checked",!1)}(),e(document).on("click",".select2-results__options li",function(){e(this).find("li").toggle()}),e(document).on("click",".select2-results__option",function(){e(".expand-minimize",this).hasClass("dashicons-minus")?e(".expand-minimize",this).removeClass("dashicons-minus").addClass("dashicons-plus"):e(".expand-minimize",this).removeClass("dashicons-plus").addClass("dashicons-minus")});var $=!1;e(document).on("guided_tour.init",function(t,a){$||(f("advanced"),e(document).on("goftj_rss_content_loaded",function(t,a){"yes"===goft_wpjm_admin_l18n.can_use_premium&&e(".tr-auto-schedule").show(),$||e(document).guided_tour(),$=!0}),e(document).on("click",".button.gofetch-wpjm-tour1_0_step4_2",function(){e("#rss_feed_import").val(e("#rss_feed_import").data("example")),e(".import-feed").click()}),e(document).on("click",".button.gofetch-wpjm-tour1_0_step13",function(){e(".tr-auto-schedule").show()}))}),e(document).on("change","#goft-settings-type",function(t){var a=e("#goft-settings-type:checked").val(),n={action:"goft_wpjm_toggle_settings",toggle:a,_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};e.post(goft_wpjm_admin_l18n.ajaxurl,n),f(a),u()}),e(document).on("goftj_rss_template_loaded",function(t,a,n){if(n.provider_id){var i=n.rss_feed_import.split("?");if(i.length){var o=new URLSearchParams(i[1]);e("#providers_list").val(n.provider_id).trigger("change",[o,n,!0])}}j(a),e(".import-feed:visible").click()}),e(document).on("goftj_rss_content_loaded",function(t,i){(R=!0,u(),e(".helper-fields").append('<input type="hidden" name="provider_id" value="'+i.id+'"></input>'),e(".tr-special-scrape-options").removeClass("temp-tr-hide tr-advanced tr-advanced-show").hide(),w(!0),void 0!==i.special?(e.each(i.special,function(t,a){e("[data-special="+t+"]").find("option").remove(),Object.keys(a).forEach(function(n){var i=!1;void 0!==A.special&&A.special&&void 0!==A.special[t]?i=A.special[t].indexOf(n)>=0&&"selected":void 0!==goft_wpjm_admin_l18n.scrape_fields&&goft_wpjm_admin_l18n.scrape_fields&&Object.keys(goft_wpjm_admin_l18n.scrape_fields).length&&(i=Object.keys(goft_wpjm_admin_l18n.scrape_fields).find(function(e){return goft_wpjm_admin_l18n.scrape_fields[e]===n})>=0&&"selected"),e("[data-special="+t+"]").find("option").end().append(e("<option></option>").val(n).text(a[n].nicename).prop("selected",i))}),e(".tr-special-"+t+"-options").hide(),e("[data-special="+t+"]").select2({placeholder:goft_wpjm_admin_l18n.label_scrape_fields}),e(".tr-special-"+t+"-options").removeClass("tr-hide").addClass("tr-advanced tr-advanced-show").show()}),e(".tr-special-scrape-options").addClass("temp-tr-hide"),a()):e(".tr-special-scrape-options").hide(),v("data-remote=1",i.remote_only||!1),e(".tr-rss-file").is(":visible"))?(e(".tr-save").hide(),e(".tr-template-name").hide(),e("#providers_list").val("").trigger("change",["","",!0])):(e(".tr-save").show(),e(".tr-template-name").show());n()}),e("#goft-settings-type").trigger("change"),e(document).on("click",".feed-type-toggle",function(t){e(".tr-rss-toggle").toggle();var a=e(".tr-rss-file").is(":visible");return e(".tr-save, .tr-template-name, .save-warning").toggle(!a),e(".tr-replace-jobs").toggle(!a),!1}),e(document).on("click",".refresh-templates",function(t){e("#templates_list option").filter(function(){return this.value}).remove(),e(".goft_wpjm.processing.templates").length||(U.hide().after('<div class="goft_wpjm processing templates">&nbsp;</div>'),e(".import-feed").prop("disabled",!0));var a={action:"goft_wpjm_update_templates_list",_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};return e.post(goft_wpjm_admin_l18n.ajaxurl,a,function(t){void 0!==t&&void 0!==t.templates&&(e.each(t.templates,function(t,a){var n=!1;e("#templates_list option").filter(function(t){if(-1!==e(this).attr("value").indexOf(a))return void(n=!0)}),n||e("#templates_list").append(e("<option>",{value:a}).text(a))}),e("#templates_list").trigger("change")),e(".goft_wpjm.processing.templates").remove(),e(".import-feed").prop("disabled",!1),U.show()},"json"),t.preventDefault(),!1}),e(document).on("click",".import-feed",function(t){e(".feed-type-toggle").hide(),S=e(".tr-rss-file").is(":visible");var a="",n=e("#gofj_import")[0],i=new FormData(n),o=document.getElementById("import_local_file"),s=o.files[0]||!1;if(S&&s?(S=!0,a=s.name,i.append("file_upload",1)):(a=e("#rss_feed_import").val(),i.append("file_upload",0)),e(".limit-warn").remove(),!a)return alert(goft_wpjm_admin_l18n.msg_specify_valid_url),void t.preventDefault();if(_(!1),e(".goft_wpjm.no-jobs-found").remove(),!!e(".feed-builder").find("input.required").length){var r=e("#rss_feed_import");e(".goft_wpjm.no-jobs-found").remove();var d=goft_wpjm_admin_l18n.msg_required_params;return e(".feed-builder").find("input.required-param.required-or").length&&(d=goft_wpjm_admin_l18n.msg_required_optional_params),r.closest("label").after('<p class="goft_wpjm no-jobs-found required-parameters feed"> <span class="dashicons-before dashicons-warning"></span> '+d+"</p>"),void t.preventDefault()}return e(".goft_wpjm.processing-dog.feed").length||(e("input[name=import_feed]").hide(),e("input[name=import_feed]").after('<span class="goft_wpjm processing-dog feed">&nbsp;</span>').after('<a class="button-secondary cancel-feed-load">'+goft_wpjm_admin_l18n.cancel_feed_load+"</a>"),e("input",U).prop("disabled",!0)),i.append("url",a),i.append("action","goft_wpjm_import_feed"),i.append("load_images",e("input[name=load_images]").is(":checked")),i.append("_ajax_nonce",goft_wpjm_admin_l18n.ajax_nonce),O=e.ajax({url:goft_wpjm_admin_l18n.ajaxurl,contentType:!1,processData:!1,dataType:"json",data:i,type:"POST",success:function(t){if(void 0!==t){var n=e("#rss_feed_import");if(S&&(n=e("#import_local_file")),void 0===t.success||t.success||(t.error=t.data),void 0!==t.error)n.closest("label").after('<p class="goft_wpjm no-jobs-found feed"> <span class="dashicons-before dashicons-warning"></span> '+goft_wpjm_admin_l18n.msg_invalid_feed+": "+t.error+"</p>");else if(t.total_items>0){e(".goft_wpjm_jobs_found").remove(),e(".goft_wpjm_table").html(t.sample_item),e(".goft_wpjm_jobs_found").remove(),e(".content-type-warning").remove(),e(".goft_wpjm_table").after('<h4 class="goft_wpjm_jobs_found"><div class="available-jobs">'+t.total_items+'</div><div class="available-jobs-desc">'+goft_wpjm_admin_l18n.msg_jobs_found+"</div></h4>"),t.total_items>goft_wpjm_admin_l18n.jobs_limit_warn&&goft_wpjm_admin_l18n.msg_jobs_limit_warn&&(e(".limit-warn").remove(),e(".goft_wpjm_jobs_found").after('<div class="limit-warn secondary-container"><span class="dashicons-before dashicons-warning"></span><div> '+goft_wpjm_admin_l18n.msg_jobs_limit_warn+" </div></p>")),e("input[name=content_type]").val("RSS"),S?(e("input[name=content_type]").val(t.content_type),e(".goft_wpjm_jobs_found").after('<div class="provider-data content-type-warning secondary-container sample-table-notes">'+goft_wpjm_admin_l18n.msg_file_loaded.replace("[content_type]",t.content_type.toUpperCase())+"</div>")):t.content_type&&"RSS"!==t.content_type.toUpperCase()&&(e("input[name=content_type]").val(t.content_type),e(".goft_wpjm_jobs_found").after('<div class="provider-data content-type-warning secondary-container sample-table-notes">'+goft_wpjm_admin_l18n.msg_not_rss_feed.replace("[content_type]",t.content_type.toUpperCase())+"</div>")),e(".limit-jobs-found").remove(),e("#limit").after('<small class="limit-jobs-found">'+goft_wpjm_admin_l18n.msg_jobs_found+": <strong>"+t.total_items+"</strong></small>"),e("#limit").val()>t.total_items&&e("#limit").val(t.total_items);var i=e("#templates_list").val()&&!p();t.provider&&(c(t.provider,i),m(t.provider)),e("#templates_list").val()||e("#template_name").val(y(a)),_(!0),I="",void 0!==t.provider&&t.provider&&(I=t.provider.id),e.event.trigger({type:"goftj_rss_content_loaded"},[t.provider])}else n.closest("label").after('<p class="goft_wpjm no-jobs-found feed"> <span class="dashicons-before dashicons-warning"></span> '+goft_wpjm_admin_l18n.msg_no_jobs_found+"</p>")}e(".goft_wpjm.processing-dog").remove(),e(".cancel-feed-load").remove(),e("input[name=import_feed]").show(),e("input",U).prop("disabled",!1),g("[section=taxonomies], [section=meta], [section=source]"),e(".feed-type-toggle").show()},fail:function(t){e(".feed-type-toggle").show(),console.error(t)}}),t.preventDefault(),!1}),e(document).on("click",".cancel-feed-load",function(t){return O.abort(),e(this).remove(),e(".goft_wpjm.processing-dog").remove(),e("input[name=import_feed]").show(),e("input",U).prop("disabled",!1),t.preventDefault(),!1}),e(document).on("click",".save-template",function(t){var a=e("#template_name").val();if(!a)return void alert(goft_wpjm_admin_l18n.msg_template_missing);e(".goft_wpjm.processing.save").length||(e(".save-template").hide(),e(".save-template").after('<span class="goft_wpjm processing save">&nbsp;</span>'));var n={};e('[name^="special"]').each(function(t,a){n[e(a).data("special")]=e(a).val()});var i=e("[name*=field_mappings]").serializeArray(),o=e("select[name=feed-region_domains]").val(),s=e("select[name=feed-locale_code]").val(),r=e("select[name=feed-co]").val(),d=e("select[name=feed-country]").val(),l={action:"goft_wpjm_save_template",template:a,provider_id:I,logos:Number(e("input[name=logos]").is(":checked")),smart_tax_input:e("select[name=smart_tax_input]").val(),special:n,rss_feed_import:e("#rss_feed_import").val(),replace_jobs:e("input[name=replace_jobs]").is(":checked")?"yes":"",mappings:i,_wpnonce:goft_wpjm_admin_l18n.ajax_save_nonce,field_mappings:function(t){var a={},n=/field_mappings\[(.*?)\]/;return e.each(t,function(e,t){var i=t.name.replace(n,"$1");a[i]=t.value}),a}(i),region_domains:o,locale_code:s,co:r,country:d};return e.each(["tax_input","meta","source"],function(t,a){e('[name*="'+a+'"]').each(function(t,a){e(a).is(":checkbox")?l[e(this).prop("name")]=e(a).is(":checked")?e(this).data("default"):"":l[e(this).prop("name")]=e(this).val()})}),e.post(goft_wpjm_admin_l18n.ajaxurl,l,function(t){if(e(".save-template").show(),void 0!==t&&"1"===t){e(".save-template").after('<span class="template-saved-msg"> '+goft_wpjm_admin_l18n.msg_template_saved+"</span>");var n=!1;e("#templates_list option").filter(function(t){if(-1!==e(this).attr("value").indexOf(a))return void(n=!0)}),n||e("#templates_list").append(e("<option>",{value:a}).text(a)),e("#templates_list").val(a),j(a)?e(".tr-auto-schedule").hide():e(".tr-auto-schedule").show()}else e(".save-template").after('<span class="template-saved-msg"> '+goft_wpjm_admin_l18n.msg_save_error+"</span>");e(".template-saved-msg").delay(2e3).fadeOut(),e(".goft_wpjm.processing.save").remove()}),t.preventDefault(),!1}),e(document).on("change","#templates_list",function(){var t=e(this),a=t.val();h(!1),_(!1),e(".goft_wpjm.processing.templates").length||U.hide().after('<div class="goft_wpjm processing templates">&nbsp;</div>');var n={action:"goft_wpjm_load_template_content",template:a,_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};P(),e.post(goft_wpjm_admin_l18n.ajaxurl,n,function(n){if(n){var i=n.rss_feed_import;e("#rss_feed_import").val(i),e("#template_name").val(t.val()),e("input[name=logos]").prop("checked",Boolean(n.logos)),e("select[name=smart_tax_input]").val(n.smart_tax_input),e("#rss_feed_import").attr("data-saved-url",i),e("input[name=replace_jobs]").prop("checked","yes"===n.replace_jobs),e.each(["tax_input","meta","source"],function(t,a){e.each(n[a],function(t,n){var i='[name="'+a+"["+t+']"]';if(e(i).is(":checkbox"))return void(n?e(i).prop("checked",!0):(e(i).val(e(i).data("default")),e(i).prop("checked",!1)));if(e(i).val(n).prop("selected",!0).change(),e(i).hasClass("goft-image")&&n){var o=e(i).closest("td");e("img",o).attr("src",n)}})}),e(document).on("goftj_rss_content_loaded",function(t,a,i){e.each(n.mappings,function(t,a){e("[name='"+a.name+"']").val(a.value).prop("selected",!0).change()})}),e.event.trigger({type:"goftj_rss_template_loaded"},[a,n]),A=n}else e("#rss_feed_import").val("");e(".goft_wpjm.processing.templates").remove(),U.show()},"json"),e("#providers_list").val("").change()}),e(document).on("click",".import-posts",function(t){var a=i();if(a.length||e(".import-posts").hasClass("goft-disabled"))return a.length&&alert("There are core unmapped fields:\n - "+a.join("\n - ")+"\n\nPlease map them, and try again."),t.preventDefault(),!1;e(".import-posts").after('<div class="goft_wpjm processing-dog">&nbsp;</div>'),e(".import-posts + .goft_wpjm.processing-dog").after('<p class="import-wait-message">'+goft_wpjm_admin_l18n.msg_import_jobs+"</p>"),e(".import-posts").addClass("goft-disabled")}),e("[section=taxonomies],[section=meta], [section=source]").on("change",function(){g("[section="+e(this).attr("section")+"]")}),e(document).on("change","#providers_list",function(t,a,n,i){var o=e(this);if(i|=!1,i||_(!1),e(".goft_wpjm.processing.providers").remove(),!o.val())return void e(".providers-placeholder").closest("tr").hide();e(".goft_wpjm.processing.templates").length||e("#providers_list").next(".select2").after('<div class="goft_wpjm processing providers">&nbsp;</div>');var r={action:"goft_wpjm_load_provider_info",provider:o.val(),_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};e.post(goft_wpjm_admin_l18n.ajaxurl,r,function(t){t&&(e(".providers-placeholder-content").html(t.setup).closest("tr").fadeIn(),e(".providers-placeholder-content").append('<a class="dashicons-before dashicons-dismiss close-provider" title="'+goft_wpjm_admin_l18n.title_close+'" style="cursor: pointer;"s> hide</a>'),e(".close-provider").click(function(){o.val("").change()}),e(".providers-placeholder").slideDown(),s(t.provider,a)),e(".goft_wpjm.processing.providers").remove(),e.event.trigger({type:"goftj_rss_provider_loaded"},[t.provider,t.required_query_params,n])},"json"),C="",q=[]}),e(document).on("click","a.provider-rss, a.provider-rss-custom",function(t){return e(".rss-copied-msg").remove(),e("input[name=rss_feed_import]").val(e(this).attr("href")).addClass("input-feed-pasted"),e(this).after('<span class="rss-copied-msg" style="display: inline-block"> '+goft_wpjm_admin_l18n.msg_rss_copied+"</span>").fadeIn(),e(".rss-copied-msg").delay(1e3).fadeOut(function(){e("input[name=rss_feed_import]").removeClass("input-feed-pasted")}),P(),t.preventDefault(),!1}),e(document).on("click","[class*=provider-expand]",function(t){var a=e(this),n=e("."+a.attr("data-child"));return n.slideToggle(o(a,!n.is(":visible"))),t.preventDefault(),!1}),e(document).on("change",".feed-builder [name*=feed]",function(){e(this).keyup()}),e(document).on("keyup",'.feed-builder [name*=feed]:not(input[name="feed-url"])',function(){var t=e(this).attr("data-qarg"),a=e("[name="+t+"]").val(),n=e(this).val(),i=e(".feed-builder input[name=feed-params-sep]").val(),o=e("[name="+t+"]").attr("data-prefix");q[t]=[],n||(n=""),n=encodeURIComponent(n),a+="&"===i?"="+n:(o?"":i)+n,q[t]=a,d(q)}),e(document).on("keyup",".feed-builder input[name=feed-url]",function(t,a){a=a||!1;var n=!1;C=r();var i="domain_l"===e(".feed-builder input[name=feed-param-location]").val(),o="domain_k"===e(".feed-builder input[name=feed-param-keyword]").val();if(a&&void 0!==a.key)e(".feed-builder .params [name*=feed-]:not([name=feed-"+a.key+"]):visible").keyup();else{if(i){var s=new RegExp(e(".feed-builder input[name=feed-param-location]").attr("data-regex"));null!==(n=s.exec(C))&&e(".feed-builder input[name=feed-location]").val(n[1])}if(o){var s=new RegExp(e(".feed-builder input[name=feed-param-keyword]").attr("data-regex"));null!==(n=s.exec(C))&&e(".feed-builder input[name=feed-keyword]").val(n[1])}e(".feed-builder .params [name*=feed-]:visible").not(".feed-builder input[name=feed-url]").keyup()}}),e(document).on("change",'select[name="feed-region_domains"]',function(){var t=e('input[name="feed-url"]').val(),a=e(this).val(),n=t.replace(E,a);e('input[name="feed-url"]').val(n).keyup(),E=a}),e(document).on("goftj_rss_provider_loaded",function(t,a,n,i){var o=e(".feed-builder input[name=feed-url]").val();E=e("[name=feed-region_domains]").val();var s="domain_k"===e(".feed-builder input[name=feed-param-keyword]").val(),r="domain_l"===e(".feed-builder input[name=feed-param-location]").val();if(a.region_domains){var d=a.region_param_domain||!1;d||(d="region_domains");var l=i&&void 0!==i[d]&&i[d]?i[d]:a.region_default;if(l){e("select[name=feed-"+d+'] option[value="'+l+'"]').length||(l=a.region_default)}e("select[name=feed-"+d+"]").val(l).change()}if(n){z=n,e(".feed-builder input[name*=feed-]").removeClass("required-param required-or");var p="required-param";Object.keys(z).forEach(function(t){var a=e(".feed-builder input[name=feed-"+t+"]");"relation"===t?"relation_or"===z[t]&&(p+=" required-or"):a.val()||e(".feed-builder input[name=feed-"+t+"]").addClass(p),e(".required-param").keyup()})}if(s||r){var c,m;e(".gofj-multiselect").select2({templateResult:b}),e(".gofj-multiselect").on("select2:open",function(t){e("input.select2-search__field").prop("placeholder","type to search ... ")}),e(document).on("keyup",".feed-builder input[name=feed-location]",function(){if(r){var t=new RegExp(e(".feed-builder input[name=feed-param-location]").attr("data-regex")),a=t.exec(C);if(a.length){m=a[1]||!1;var n=e(this).val();m&&n&&n!==m&&(e(".feed-builder input[name=feed-url]").val(o.replace(m,n)),e(".feed-builder input[name=feed-url]").trigger("keyup",{key:"location"}),o=e(".feed-builder input[name=feed-url]").val(),m=n)}}}),e(document).on("keyup",".feed-builder input[name=feed-keyword]",function(){if(s){var t=new RegExp(e(".feed-builder input[name=feed-param-keyword]").attr("data-regex")),a=t.exec(C);if(a.length){c=a[1]||!1;var n=e(this).val();c&&n&&n!==c&&(e(".feed-builder input[name=feed-url]").val(o.replace(c,n)),e(".feed-builder input[name=feed-url]").trigger("keyup",{key:"keyword"}),o=e(".feed-builder input[name=feed-url]").val(),c=n)}}})}}),e(document).on("click",".reset-feed-url",function(t){return e(".feed-builder input[name=feed-url]").val(e(".feed-builder input[name=feed-url]").data("default")).keyup(),t.preventDefault(),!1}),e(document).on("click","input[name=keywords_filtering]",function(t){e(this).is(":checked")?e(".tr-keywords.tr-toggle-hide").show():e(".tr-keywords.tr-toggle-hide").hide()}),e(document).on("click",".clear_span_dates",function(){e("."+e(this).attr("data-goft_parent")).val("")}),e(document).on("click",".reset-val",function(t){var a=e('input[name="'+e(this).attr("data-parent")+'"');return e(a).val(e(a).attr("data-original")).change(),t.preventDefault(),!1}),e(".section-expand").on("click",function(t){var a=e(this).attr("expand"),n="[section="+a+"]",i=this;return e(".section-"+a+"-values").toggle(0).addClass("temp-tr-hide"),e(n).closest("tr").toggle(0,function(){e(this).addClass("temp-tr-hide"),e(this).is(":visible")?e(i).text(goft_wpjm_admin_l18n.simple):e(i).text(goft_wpjm_admin_l18n.advanced)}),g("[section=taxonomies], [section=meta], [section=source]"),t.preventDefault,!1}),e(document).on("change",".auto-schedule",function(t){if("yes"===e(this).val()){var a="(Auto Schedule) "+e("input[name=template_name]").val();e(".schedule-name").val(a),e(".auto-schedule-toggle").show()}else e(".auto-schedule-toggle").hide()})});